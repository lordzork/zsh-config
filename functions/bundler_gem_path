local dirs dir
dirs=( $PWD/vendor/bundle/ruby/*(/N) )

if [[ -n $ORIGINAL_GEM_PATH ]]; then
  export GEM_PATH=$ORIGINAL_GEM_PATH
  unset ORIGINAL_GEM_PATH
else
  unset GEM_PATH
fi

if [[ -n $dirs ]]; then
  if [[ -n $GEM_PATH ]]; then
    export ORIGINAL_GEM_PATH=$GEM_PATH
  fi

  for dir in $dirs; do
    if [[ -z $GEM_PATH ]]; then
      export GEM_PATH=$dir
    else
      export GEM_PATH="$dir:$GEM_PATH"
    fi
  done
fi

